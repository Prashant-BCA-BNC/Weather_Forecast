<!-- index.html (Updated) -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Forecast</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

</head>
<body>
    <div class="loading">
        <div class="spinner"></div>
    </div>

    <div class="container">
        <header>
            <h1>Weather Forecast</h1>
            <nav class="main-nav">
                <ul>
                    <li><a href="index.html" class="active">Home</a></li>
                    <li><a href="hourly.html">Hourly Forecast</a></li>
                    <li><a href="4day.html">4-Day Forecast</a></li>
                    <li><a href="planner.html">Event Planner</a></li>
                </ul>
            </nav>
            <div class="search-container">
                <input type="text" id="search-input" placeholder="Search for a city...">
                <button id="search-btn">Search</button>
                <button id="current-location-btn">Use My Location</button>
                <button id="save-location-btn">Save Location</button>
            </div>
        </header>

        <div id="weather-alert" class="weather-alert" style="display: none;">
            <h3>Weather Alert</h3>
            <p id="alert-text"></p>
        </div>

        <section class="current-weather">
            <h2 class="city-name" id="city-name">Loading...</h2>
            <p class="date" id="current-date">--</p>
            <p class="temperature" id="temperature">--°C</p>
            <p class="weather-description" id="weather-description">--</p>
            <div class="weather-details">
                <div class="detail">
                    <span class="material-icons">water_drop</span>
                    <p>Humidity: <span id="humidity">--%</span></p>
                </div>
                <div class="detail">
                    <span class="material-icons">air</span>
                    <p>Wind: <span id="wind-speed">-- km/h</span></p>
                </div>
                <div class="detail">
                    <span class="material-icons">compress</span>
                    <p>Pressure: <span id="pressure">-- hPa</span></p>
                </div>
            </div>
        </section>

        <section class="forecast-preview">
            <h2 class="section-title">Forecast Preview</h2>
            <div class="forecast-links">
                <a href="hourly.html" class="forecast-link">
                    <div class="preview-card">
                        <h3>Hourly Forecast</h3>
                        <p>Check detailed hourly weather updates</p>
                        <span class="view-more">View More →</span>
                    </div>
                </a>
                <a href="4day.html" class="forecast-link">
                    <div class="preview-card">
                        <h3>4-Day Forecast</h3>
                        <p>Plan ahead with our extended forecast</p>
                        <span class="view-more">View More →</span>
                    </div>
                </a>
                <a href="planner.html" class="forecast-link">
                    <div class="preview-card highlight">
                        <h3>Event Weather Planner</h3>
                        <p>Check weather for your upcoming events</p>
                        <span class="view-more">Plan Now →</span>
                    </div>
                </a>
            </div>
        </section>

        <section class="saved-locations">
            <h2 class="section-title">Saved Locations</h2>
            <div class="locations-grid" id="saved-locations-container">
                <!-- Saved locations will be added here dynamically -->
            </div>
        </section>

        <footer>
            <p>Weather data provided by OpenWeatherMap API</p>
            <p>Developed by BCA Semester 6 Students(Prashant Ranjan, Rupak Kumar, Ritesh Kumar)</p>
        </footer>
    </div>

    <script>
    const API_KEY = "a2253a3e39bddcbae326acff50a2e65c";

    function showLoading() {
        document.querySelector('.loading').classList.add('active');
    }

    function hideLoading() {
        document.querySelector('.loading').classList.remove('active');
    }

    function showAlert(message) {
        const alertBox = document.getElementById('weather-alert');
        document.getElementById('alert-text').textContent = message;
        alertBox.style.display = 'block';
    }
    function setBackgroundByWeather(condition, timeOfDay) {
    let bg;

    switch (condition.toLowerCase()) {
        case 'clear':
            bg = timeOfDay === 'day' ?
                'https://images.unsplash.com/photo-1601297183305-6df142704ea2' :
                'https://images.unsplash.com/photo-1531306728370-e2ebd9d7bb99';
            break;
        case 'clouds':
            bg = timeOfDay === 'day' ?
                'https://images.unsplash.com/photo-1525920955777-02e13f29c7f0' :
                'https://images.unsplash.com/photo-1534088568595-a066f410bcda';
            break;
        case 'rain':
        case 'drizzle':
            bg = 'https://images.unsplash.com/photo-1515694346937-94d85e41e6f0';
            break;
        case 'thunderstorm':
            bg = 'https://images.unsplash.com/photo-1605727216801-e27ce1d0cc28';
            break;
        case 'snow':
            bg = 'https://images.unsplash.com/photo-1491002052546-bf38f186af56';
            break;
        case 'mist':
        case 'fog':
        case 'haze':
            bg = 'https://images.unsplash.com/photo-1585508889431-a1d0d9c5a324';
            break;
        default:
            bg = timeOfDay === 'day' ?
                'https://images.unsplash.com/photo-1601297183305-6df142704ea2' :
                'https://images.unsplash.com/photo-1531306728370-e2ebd9d7bb99';
    }
    const bgUrl = `url('${bg}?auto=format&fit=crop&w=1350&q=80')`;
    document.body.style.backgroundImage = bgUrl;
    localStorage.setItem('currentBackground', bgUrl);
    document.body.style.backgroundImage = `url('${bg}?auto=format&fit=crop&w=1350&q=80')`;
}

function isDaytime(currentTime, sunrise, sunset) {
    return currentTime > sunrise && currentTime < sunset ? 'day' : 'night';
}

    async function updateWeather(city) {
        try {
            showLoading();
            const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${API_KEY}&units=metric`);
            const data = await res.json();
            const timeOfDay = isDaytime(data.dt, data.sys.sunrise, data.sys.sunset);
            setBackgroundByWeather(data.weather[0].main, timeOfDay);

            if (!res.ok) throw new Error(data.message);

            document.getElementById('city-name').textContent = `${data.name}, ${data.sys.country}`;
            document.getElementById('current-date').textContent = new Date().toLocaleDateString();
            document.getElementById('temperature').textContent = `${Math.round(data.main.temp)}°C`;
            document.getElementById('weather-description').textContent = data.weather[0].description;
            document.getElementById('humidity').textContent = `${data.main.humidity}%`;
            document.getElementById('wind-speed').textContent = `${(data.wind.speed * 3.6).toFixed(1)} km/h`;
            document.getElementById('pressure').textContent = `${data.main.pressure} hPa`;

            if (data.weather[0].main.toLowerCase().includes("storm")) {
                showAlert("Storm warning in effect. Please stay indoors.");
            }

            localStorage.setItem("lastCity", city);
            hideLoading();
        } catch (err) {
            alert("Error: " + err.message);
            hideLoading();
        }
    }

    function loadSavedLocations() {
    const container = document.getElementById("saved-locations-container");
    const saved = JSON.parse(localStorage.getItem("savedLocations")) || [];
    
    container.innerHTML = saved.map(loc => `
        <div class="location-card" onclick="updateWeather('${loc}')">
            ${loc}
            <button class="remove-location" onclick="removeLocation('${loc}', event)">×</button>
        </div>
        `).join("");
    }

    // function to handle location removal
    function removeLocation(location, event) {
        event.stopPropagation(); // Prevent triggering the parent click
        let saved = JSON.parse(localStorage.getItem("savedLocations")) || [];
        saved = saved.filter(loc => loc !== location);
        localStorage.setItem("savedLocations", JSON.stringify(saved));
        loadSavedLocations();
    }

    document.addEventListener("DOMContentLoaded", () => {
        const lastCity = localStorage.getItem("lastCity") || "London";
        updateWeather(lastCity);
        loadSavedLocations();

        document.getElementById("search-btn").addEventListener("click", () => {
            const city = document.getElementById("search-input").value.trim();
            if (city) updateWeather(city);
        });

        document.getElementById("save-location-btn").addEventListener("click", () => {
            const city = document.getElementById("city-name").textContent.split(",")[0];
            let saved = JSON.parse(localStorage.getItem("savedLocations")) || [];
            if (!saved.includes(city)) {
                saved.push(city);
                localStorage.setItem("savedLocations", JSON.stringify(saved));
                loadSavedLocations();
            }
        });
    });
    </script>
</body>
</html>
